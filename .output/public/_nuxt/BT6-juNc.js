import{_ as T,a as j,b as P,u as B}from"./CFiBINGE.js";import{h as U,r,o as d,c as _,a as t,b as p,w as I,d as N,t as b,i as V,v as A,n as D,j as C,k as M,F as q,l as z,m as k,q as E}from"./CtvG9C47.js";const H={class:"max-w-7xl mx-auto p-6 bg-background text-text h-[40rem] flex items-center justify-center"},L={class:"w-full max-w-5xl p-6 rounded-lg flex flex-col md:grid md:grid-cols-2 md:gap-x-36 place-items-center"},G={class:"w-full md:w-auto flex justify-center mb-6 md:mb-0"},O=["src"],W={class:"flex flex-col space-y-6 w-full md:pl-8"},J={class:"text-center"},K={class:"text-2xl md:text-3xl font-bold mb-4"},Q={class:"text-accent"},X={class:"text-md md:text-lg font-semibold mt-2"},Y={class:"flex flex-col items-center mb-6"},Z={class:"w-full mb-6"},ee=t("h2",{class:"text-lg md:text-xl font-semibold mb-2 text-center"},"Leave a comment:",-1),te={class:"mt-4 flex flex-col items-center w-full"},se=U({__name:"Feed",props:{imagePaths:{},imageIds:{},randomUser:{}},setup(w){const h=w,u=r(1),c=r(0),o=r(""),i=r(null),m=r(""),v={item:"basis-full",container:"rounded-lg",indicators:{wrapper:"relative bottom-0 mt-4"}};function x(e){c.value=e}function f(e,l){u.value=e,l(e)}async function s(){const e=new FormData;e.append("imageId",h.imageIds[u.value-1]),c.value>0&&e.append("starRating",String(c.value)),o.value.trim()&&e.append("comment",o.value),a();const l=await $fetch("/api/recieve-rating",{method:"POST",body:e});l.error?n(l.error,"text-red-500"):n("Successfully rated!","text-green-500")}function a(){c.value=0,o.value=""}function n(e,l){i.value=e,m.value=l}return(e,l)=>{const S=T,$=j,F=P;return d(),_("div",H,[t("div",L,[t("div",G,[p($,{items:e.imagePaths,ui:v,indicators:"",class:"w-full md:w-[30rem] mx-auto"},{default:I(({item:g})=>[t("img",{src:g,class:"w-full",draggable:"false"},null,8,O)]),indicator:I(({onClick:g,page:y,active:R})=>[p(S,{label:String(y),variant:R?"solid":"outline",size:"2xs",class:"rounded-full min-w-6 justify-center",onClick:ce=>f(y,g)},null,8,["label","variant","onClick"])]),_:1},8,["items"])]),t("div",W,[t("div",J,[t("h1",K,[N(" Username: "),t("span",Q,b(e.randomUser),1),t("h2",X,"Rating image number: "+b(u.value),1)])]),t("div",Y,[p(F,{"read-only":!1,"rating-size":24,"rating-value":c.value,"border-color":"#db8403","active-color":"#ffa41c","inactive-color":"#111827","rating-step":.5,"rating-level":10,"rating-count":10,"rounded-corners":!0,"border-width":5,onRatingSelected:x,class:"bg-background"},null,8,["rating-value"])]),t("div",Z,[ee,V(t("textarea",{"onUpdate:modelValue":l[0]||(l[0]=g=>o.value=g),rows:"4",class:"w-full p-4 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-accent",placeholder:"Write your comment here..."},null,512),[[A,o.value]])]),t("div",te,[t("button",{onClick:s,class:"bg-accent text-white px-4 py-2 rounded-lg hover:bg-accent-dark"}," Submit "),i.value?(d(),_("p",{key:0,class:D([m.value,"mt-5"])},b(i.value),3)):C("",!0)])])])])}}}),ae={key:0,class:"flex justify-center items-center h-screen"},ne=t("p",{class:"text-center text-5xl text-white"},"There are currently no photos to be rated.",-1),oe=[ne],le={class:"flex-1"},re={key:0,class:"text-center text-xl font-bold mb-10 mt-4 text-white"},ue=U({__name:"index",async setup(w){let h,u;const c=r([]),o=r(!1),i=r(!1),m=r(new Set);async function v(){const f=Array.from(m.value).join(","),s=await $fetch("/api/random",{method:"GET",query:{fetchedUserIds:f}});s!=null&&s.data.randomUsers?s.data.randomUsers.length===0?o.value=!0:(i.value=!1,s.data.randomUsers.forEach(a=>{var n;a.userId&&!m.value.has(a.userId)&&(m.value.add(a.userId),c.value.push({imageIds:a.imageIds??[],username:a.username??"",userId:a.userId,imagePath:((n=a.imageIds)==null?void 0:n.map(e=>`/user-photos/${a.userId}/id_${e}.webp`))??[]}))})):i.value=!0}const x=B(async f=>{if(o.value)return;const s=f.target;s.scrollHeight-s.scrollTop<=s.clientHeight+5&&await v()},300);return[h,u]=M(()=>v()),await h,u(),(f,s)=>{const a=se;return i.value?(d(),_("div",ae,oe)):(d(),_("div",{key:1,onScroll:s[0]||(s[0]=(...n)=>k(x)&&k(x)(...n)),class:"h-screen overflow-auto flex flex-col"},[t("div",le,[(d(!0),_(q,null,z(c.value,n=>(d(),E(a,{key:n.userId,"image-paths":n.imagePath,"image-ids":n.imageIds,"random-user":n.username},null,8,["image-paths","image-ids","random-user"]))),128))]),o.value?(d(),_("div",re," All users have been fetched. ")):C("",!0)],32))}}});export{ue as default};
